<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Encore Marketing Report | GovCon Giants Partnership</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f0f12;
      --surface: #18181c;
      --surface-hover: #222228;
      --text: #f4f4f5;
      --text-muted: #a1a1aa;
      --accent: #6366f1;
      --accent-light: #818cf8;
      --green: #86efac;
      --yellow: #fde68a;
      --red: #fca5a5;
      --border: #27272a;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'DM Sans', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
    }

    .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }

    header {
      text-align: center;
      padding: 3rem 0 2rem;
      border-bottom: 1px solid var(--border);
    }
    header h1 { font-size: 2rem; font-weight: 700; letter-spacing: -0.02em; margin-bottom: 0.5rem; }
    header p { color: var(--text-muted); font-size: 1rem; }

    /* KPI Metrics Row */
    .metrics-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin: 1.5rem 0;
    }
    .metric-box {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1rem;
    }
    .metric-box .label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
    }
    .metric-box .value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.35rem;
      font-weight: 600;
      margin-top: 0.25rem;
    }
    .metric-box .sub {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.2rem;
    }

    /* View Tabs */
    .view-tabs {
      display: flex;
      gap: 0.5rem;
      margin: 1.5rem 0;
    }
    .view-tab {
      padding: 0.6rem 1.25rem;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text-muted);
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .view-tab:hover { background: var(--surface-hover); color: var(--text); }
    .view-tab.active { background: var(--accent); color: white; border-color: var(--accent); }

    /* Section headers */
    .section { margin: 2rem 0; }
    .section h2 {
      font-size: 1rem;
      color: var(--text-muted);
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border);
    }

    /* Sparkline chart card */
    .chart-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1rem;
      overflow: hidden;
    }
    .chart-card h3 {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 0.75rem;
    }

    /* Two-column layout */
    .grid-2 { display: grid; grid-template-columns: 1.5fr 1fr; gap: 1rem; }

    /* Channel bars */
    .bar-list { display: grid; gap: 0.6rem; }
    .bar-row { display: grid; grid-template-columns: 80px 1fr 84px; gap: 0.75rem; align-items: center; }
    .bar-row .name { font-size: 0.85rem; color: var(--text-muted); }
    .bar-track { height: 16px; background: var(--border); border-radius: 6px; overflow: hidden; }
    .bar-fill { height: 100%; border-radius: 6px; }
    .bar-fill.youtube { background: linear-gradient(90deg, #dc2626, #ff6b6b); }
    .bar-fill.linkedin { background: linear-gradient(90deg, #0a66c2, #60a5fa); }
    .bar-fill.fhc { background: linear-gradient(90deg, var(--accent), var(--accent-light)); }
    .bar-fill.instagram { background: linear-gradient(90deg, #c026d3, #f472b6); }
    .bar-fill.podcast { background: linear-gradient(90deg, #059669, #86efac); }
    .bar-fill.default { background: linear-gradient(90deg, var(--accent), var(--accent-light)); }
    .bar-val { text-align: right; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: var(--text-muted); }

    /* Month cards grid */
    .month-links {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 0.75rem;
    }
    .month-link {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      padding: 1rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      text-decoration: none;
      transition: all 0.2s;
    }
    .month-link:hover {
      background: var(--surface-hover);
      border-color: var(--accent);
      color: var(--accent-light);
      text-decoration: none;
    }
    .month-link .month-name { font-weight: 600; font-size: 1rem; }
    .month-link .month-stat {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      color: var(--text-muted);
    }
    .month-link.empty { opacity: 0.35; }
    .month-link.empty .month-stat { font-style: italic; }

    /* Deliverable Tracker */
    .tracker-list {
      display: grid;
      gap: 0.75rem;
      max-width: 700px;
    }
    .tracker-group {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1rem 1.25rem;
    }
    .tracker-group h4 {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .progress-row {
      display: grid;
      grid-template-columns: 1fr 150px 80px;
      gap: 0.75rem;
      align-items: center;
      padding: 0.4rem 0;
    }
    .progress-label { font-size: 0.9rem; }
    .progress-bar {
      height: 10px;
      background: var(--border);
      border-radius: 6px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      border-radius: 6px;
      background: linear-gradient(90deg, var(--accent), var(--accent-light));
      transition: width 0.5s;
    }
    .progress-fill.full { background: linear-gradient(90deg, #059669, var(--green)); }
    .progress-fill.warn { background: linear-gradient(90deg, #d97706, var(--yellow)); }
    .progress-count {
      text-align: right;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* Top content table */
    .table-wrap {
      overflow-x: auto;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--surface);
    }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 0.7rem 1rem; text-align: left; border-bottom: 1px solid var(--border); }
    th {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      font-weight: 600;
    }
    tr:last-child td { border-bottom: none; }
    tr:hover td { background: var(--surface-hover); }
    .channel-badge { display: inline-block; padding: 0.2rem 0.5rem; border-radius: 6px; font-size: 0.75rem; font-weight: 600; }
    .channel-youtube { background: rgba(255,0,0,0.2); color: #ff6b6b; }
    .channel-linkedin { background: rgba(10,102,194,0.2); color: #60a5fa; }
    .channel-instagram { background: rgba(228,64,95,0.2); color: #f472b6; }
    .channel-fhc { background: rgba(99,102,241,0.2); color: var(--accent-light); }
    .channel-podcast { background: rgba(5,150,105,0.2); color: #86efac; }
    .num { font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; }
    a { color: var(--accent-light); text-decoration: none; }
    a:hover { text-decoration: underline; }

    footer {
      text-align: center;
      padding: 3rem 0;
      color: var(--text-muted);
      font-size: 0.85rem;
    }

    @media (max-width: 900px) { .grid-2 { grid-template-columns: 1fr; } }
    @media (max-width: 768px) {
      .container { padding: 1rem; }
      .metrics-row { grid-template-columns: repeat(2, 1fr); }
      .progress-row { grid-template-columns: 1fr; gap: 0.25rem; }
    }

    @media print {
      body { background: white; color: black; }
      .view-tabs { display: none; }
      .metric-box { border: 1px solid #ccc; background: #f9f9f9; }
      .metric-box .label, .metric-box .sub { color: #666; }
      .chart-card { break-inside: avoid; border: 1px solid #ccc; background: #f9f9f9; }
      a { color: black; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Encore Marketing Report</h1>
      <p>GovCon Giants Partnership &middot; Executive Dashboard</p>
    </header>

    <!-- Executive KPIs -->
    <div id="exec-kpis" class="metrics-row"></div>

    <!-- View Tabs -->
    <div class="view-tabs">
      <button class="view-tab active" data-view="overview">Overview</button>
      <button class="view-tab" data-view="months">Monthly Reports</button>
      <button class="view-tab" data-view="deliverables">Deliverables</button>
    </div>

    <!-- Overview View -->
    <div id="overview-view">
      <div class="grid-2">
        <div class="chart-card">
          <h3>Impressions Trend</h3>
          <div id="sparkline-chart"></div>
        </div>
        <div class="chart-card">
          <h3>Channel Performance (All Time)</h3>
          <div class="bar-list" id="channel-summary"></div>
        </div>
      </div>

      <div class="section">
        <h2>Top Performing Content</h2>
        <div class="table-wrap" id="top-content"></div>
      </div>
    </div>

    <!-- Monthly Reports View -->
    <div id="months-view" style="display:none">
      <div class="month-links" id="month-links"></div>
    </div>

    <!-- Deliverables View -->
    <div id="deliverables-view" style="display:none">
      <div class="tracker-list" id="deliverable-tracker"></div>
    </div>

    <footer>
      Encore &times; GovCon Giants Partnership Report &middot; March 2025 &ndash; January 2026
    </footer>
  </div>

  <script src="report-data.js"></script>
  <script>
    const MONTH_NAMES = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    const data = window.REPORT_DATA || { months: [], items: [], aggregates: {}, series: {} };
    const months = data.months || [];

    function fmtMonth(key) {
      const [y, m] = key.split('-');
      return MONTH_NAMES[parseInt(m, 10) - 1] + ' ' + y;
    }

    function n(v) { return (v || 0).toLocaleString(); }

    // ── Executive KPIs ──
    (function renderKPIs() {
      let imp = 0, views = 0, eng = 0, clicks = 0, attend = 0, webinarChats = 0, emailSends = 0, articleViews = 0, podcastDownloads = 0, podcastListeners = 0, items = 0;
      months.forEach(m => {
        const agg = data.aggregates[m] || {};
        const t = agg.totals || {};
        const byCh = agg.by_channel || {};
        imp += t.impressions || 0;
        views += t.views || 0;
        eng += t.engagements || 0;
        clicks += t.clicks || 0;
        attend += t.attendees || 0;
        emailSends += t.email_sends || 0;
        articleViews += t.article_views || 0;
        items += t.items || 0;
        // Only count chat_count from FHC (webinars), not from other channels
        webinarChats += (byCh.FHC || {}).chat_count || 0;
        // Podcast: impressions = downloads, views = unique listeners
        podcastDownloads += (byCh.Podcast || {}).impressions || 0;
        podcastListeners += (byCh.Podcast || {}).views || 0;
      });
      const activeMonths = months.filter(m => {
        const t = (data.aggregates[m] || {}).totals || {};
        return (t.items || 0) > 0;
      }).length;

      let html = `
        <div class="metric-box"><div class="label">Total Impressions</div><div class="value">${n(imp)}</div><div class="sub">${activeMonths} active months</div></div>
        <div class="metric-box"><div class="label">Total Views</div><div class="value">${n(views)}</div><div class="sub">${((views/Math.max(imp,1))*100).toFixed(1)}% view rate</div></div>
        <div class="metric-box"><div class="label">Engagements</div><div class="value">${n(eng)}</div><div class="sub">${n(clicks)} clicks</div></div>
        <div class="metric-box"><div class="label">Content Pieces</div><div class="value">${n(items)}</div><div class="sub">across ${months.length} months</div></div>
        <div class="metric-box"><div class="label">Webinar Attendees</div><div class="value">${n(attend)}</div><div class="sub">${n(webinarChats)} chat messages</div></div>`;
      if (emailSends > 0) {
        html += `<div class="metric-box"><div class="label">Email Sends</div><div class="value">${n(emailSends)}</div><div class="sub">${articleViews > 0 ? n(articleViews) + ' article views' : 'Newsletter distribution'}</div></div>`;
      }
      if (podcastDownloads > 0) {
        html += `<div class="metric-box"><div class="label">Podcast Downloads</div><div class="value">${n(podcastDownloads)}</div><div class="sub">${podcastListeners > 0 ? n(podcastListeners) + ' unique listeners' : 'Total downloads'}</div></div>`;
      }
      document.getElementById('exec-kpis').innerHTML = html;
    })();

    // ── Sparkline Chart ──
    (function renderSparkline() {
      const values = data.series.impressions || months.map(() => 0);
      const w = 760, h = 180;
      const pad = { l: 50, r: 16, t: 12, b: 28 };
      const innerW = w - pad.l - pad.r;
      const innerH = h - pad.t - pad.b;
      const maxV = Math.max(...values, 1);
      const x = (i) => pad.l + (innerW * (values.length <= 1 ? 0 : i / (values.length - 1)));
      const y = (v) => pad.t + innerH - (innerH * (v / maxV));

      const pts = values.map((v, i) => `${x(i)},${y(v)}`).join(' ');
      const areaPts = pts + ` ${x(values.length-1)},${h-pad.b} ${x(0)},${h-pad.b}`;

      const circles = values.map((v, i) =>
        `<circle cx="${x(i)}" cy="${y(v)}" r="3.5" fill="#6366f1" opacity="0.9"><title>${fmtMonth(months[i])}: ${n(v)}</title></circle>`
      ).join('');

      const labels = values.map((v, i) => {
        const [yy, mm] = months[i].split('-');
        return `<text x="${x(i)}" y="${h - 8}" text-anchor="middle" font-size="10" fill="#a1a1aa">${MONTH_NAMES[parseInt(mm,10)-1]}</text>`;
      }).join('');

      // Y-axis ticks
      const yTicks = [0, Math.round(maxV/2), maxV].map(v =>
        `<text x="${pad.l - 8}" y="${y(v) + 3}" text-anchor="end" font-size="9" fill="#52525b">${(v/1000).toFixed(0)}k</text>
         <line x1="${pad.l}" y1="${y(v)}" x2="${w - pad.r}" y2="${y(v)}" stroke="#27272a" stroke-dasharray="3 3" />`
      ).join('');

      document.getElementById('sparkline-chart').innerHTML = `
        <svg viewBox="0 0 ${w} ${h}" width="100%" height="${h}">
          ${yTicks}
          <polygon points="${areaPts}" fill="url(#sparkGrad)" opacity="0.15" />
          <polyline points="${pts}" fill="none" stroke="#6366f1" stroke-width="2.5" stroke-linejoin="round" />
          ${circles}
          ${labels}
          <defs><linearGradient id="sparkGrad" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#6366f1"/><stop offset="100%" stop-color="#6366f1" stop-opacity="0"/></linearGradient></defs>
        </svg>
      `;
    })();

    // ── Channel Performance Summary ──
    (function renderChannelSummary() {
      const chTotals = {};
      months.forEach(m => {
        const byCh = ((data.aggregates[m] || {}).by_channel) || {};
        Object.keys(byCh).forEach(ch => {
          if (!chTotals[ch]) chTotals[ch] = { impressions: 0, views: 0, items: 0 };
          chTotals[ch].impressions += byCh[ch].impressions || 0;
          chTotals[ch].views += byCh[ch].views || 0;
          chTotals[ch].items += byCh[ch].items || 0;
        });
      });
      const rows = Object.entries(chTotals).sort((a, b) => b[1].impressions - a[1].impressions);
      const maxImp = Math.max(...rows.map(r => r[1].impressions), 1);
      const chClass = { Youtube: 'youtube', LinkedIn: 'linkedin', FHC: 'fhc', Instagram: 'instagram', Podcast: 'podcast' };

      document.getElementById('channel-summary').innerHTML = rows.map(([ch, d]) => {
        const pct = (d.impressions / maxImp * 100).toFixed(1);
        const cls = chClass[ch] || 'default';
        return `
          <div class="bar-row">
            <div class="name">${ch}</div>
            <div class="bar-track"><div class="bar-fill ${cls}" style="width:${pct}%"></div></div>
            <div class="bar-val">${n(d.impressions)}</div>
          </div>`;
      }).join('');
    })();

    // ── Top 5 Content ──
    (function renderTopContent() {
      const top = [...data.items]
        .filter(i => i.impressions != null && i.impressions > 0)
        .sort((a, b) => (b.impressions || 0) - (a.impressions || 0))
        .slice(0, 10);

      const chMap = { Youtube: 'youtube', LinkedIn: 'linkedin', Instagram: 'instagram', FHC: 'fhc', Podcast: 'podcast' };
      const trs = top.map((it, idx) => {
        const ch = chMap[it.channel] || 'fhc';
        const titleText = it.title || '(untitled)';
        const title = (it.link && it.link_type === 'direct')
          ? `<a href="${it.link}" target="_blank" rel="noopener">${titleText}</a>`
          : it.link
            ? `${titleText} <a href="${it.link}" target="_blank" rel="noopener" style="opacity:0.5;font-size:0.8em">${it.channel} &#8599;</a>`
            : titleText;
        // Build extra info for non-standard metrics
        let extra = '';
        if (it.email_sends) extra += `${n(it.email_sends)} sends`;
        if (it.article_views) extra += `${extra ? ' · ' : ''}${n(it.article_views)} reads`;
        if (it.attendees) extra += `${extra ? ' · ' : ''}${n(it.attendees)} attendees`;
        return `<tr>
          <td class="num">${idx + 1}</td>
          <td>${title}</td>
          <td><span class="channel-badge channel-${ch}">${it.channel}</span></td>
          <td>${it.type || ''}</td>
          <td class="num">${n(it.impressions)}</td>
          <td class="num">${it.views != null ? n(it.views) : (extra || '-')}</td>
          <td>${fmtMonth(it.month)}</td>
        </tr>`;
      }).join('');

      document.getElementById('top-content').innerHTML = `
        <table>
          <thead><tr><th>#</th><th>Title</th><th>Channel</th><th>Type</th><th>Impressions</th><th>Views</th><th>Month</th></tr></thead>
          <tbody>${trs}</tbody>
        </table>`;
    })();

    // ── Month Cards ──
    (function renderMonthCards() {
      const cards = months.map(k => {
        const agg = (data.aggregates[k] || {}).totals || {};
        const isEmpty = (agg.items || 0) === 0;
        const imp = n(agg.impressions || 0);
        const itemCount = agg.items || 0;
        return `
          <a href="monthly-report.html?month=${k}" class="month-link ${isEmpty ? 'empty' : ''}">
            <div class="month-name">${fmtMonth(k)}</div>
            <div class="month-stat">${isEmpty ? 'No data' : imp + ' impressions'}</div>
            <div class="month-stat">${isEmpty ? '' : itemCount + ' items'}</div>
          </a>`;
      });
      document.getElementById('month-links').innerHTML = cards.join('');
    })();

    // ── Deliverable Tracker ──
    (function renderTracker() {
      const items = data.items || [];
      const trackers = [
        {
          group: 'YouTube',
          rows: [
            { name: 'Sponsored Videos (2/mo)', target: 24,
              actual: items.filter(i => i.channel === 'Youtube' && i.type === 'Sponsored Video').length },
            { name: 'Custom Videos (5/yr)', target: 5,
              actual: items.filter(i => i.channel === 'Youtube' && i.type === 'Custom Video').length },
          ]
        },
        {
          group: 'LinkedIn',
          rows: [
            { name: 'Sponsored Posts (2/mo)', target: 24,
              actual: items.filter(i => i.channel === 'LinkedIn' && i.type === 'Sponsored Post').length },
            { name: 'Articles (1/mo)', target: 12,
              actual: items.filter(i => i.channel === 'LinkedIn' && i.type === 'Article').length },
          ]
        },
        {
          group: 'Federal Help Center',
          rows: [
            { name: 'Webinars (2/mo)', target: 24,
              actual: items.filter(i => i.channel === 'FHC' && i.type === 'Webinar').length },
          ]
        },
        {
          group: 'Instagram',
          rows: [
            { name: 'Posts', target: null,
              actual: items.filter(i => i.channel === 'Instagram').length },
          ]
        },
        {
          group: 'Podcast',
          rows: [
            { name: 'Sponsored Episodes (1/mo)', target: 12,
              actual: items.filter(i => i.channel === 'Podcast' && i.type === 'Sponsored Episode').length },
            { name: 'Ad Spots', target: null,
              actual: items.filter(i => i.channel === 'Podcast' && i.type === 'Ad Spot').length },
          ]
        },
      ];

      document.getElementById('deliverable-tracker').innerHTML = trackers.map(t => {
        const rowsHTML = t.rows.map(r => {
          const pct = r.target ? Math.min((r.actual / r.target) * 100, 100) : 100;
          const fillCls = r.target == null ? '' : (pct >= 100 ? 'full' : pct >= 50 ? '' : 'warn');
          const countText = r.target ? `${r.actual}/${r.target}` : `${r.actual}`;
          return `
            <div class="progress-row">
              <div class="progress-label">${r.name}</div>
              <div class="progress-bar"><div class="progress-fill ${fillCls}" style="width:${pct.toFixed(0)}%"></div></div>
              <div class="progress-count">${countText}</div>
            </div>`;
        }).join('');
        return `<div class="tracker-group"><h4>${t.group}</h4>${rowsHTML}</div>`;
      }).join('');
    })();

    // ── Tab Switching ──
    const views = { overview: 'overview-view', months: 'months-view', deliverables: 'deliverables-view' };
    document.querySelectorAll('.view-tab').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.view-tab').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        Object.values(views).forEach(id => document.getElementById(id).style.display = 'none');
        document.getElementById(views[btn.dataset.view]).style.display = 'block';
      });
    });
  </script>
</body>
</html>
